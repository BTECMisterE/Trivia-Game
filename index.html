<!DOCTYPE html>
<html>
<head>
    <title>Ultimate Trivia - Host</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --main-blue: #1a1a2e; --accent: #00d2ff; --gold: #ffd700; }
        body { background: var(--main-blue); color: white; font-family: sans-serif; text-align: center; margin: 0; padding-bottom: 100px; }
        
        .scoreboard { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; padding: 20px; background: rgba(0,0,0,0.3); }
        .team-card { background: #16213e; border: 2px solid var(--accent); padding: 15px; border-radius: 10px; min-width: 160px; }
        .team-card.highlight { border-color: var(--gold); box-shadow: 0 0 20px var(--gold); transform: scale(1.05); }
        .score-display { font-size: 2.5em; color: var(--gold); font-weight: bold; margin: 10px 0; }
        
        .grid { display: grid; gap: 15px; padding: 30px; max-width: 1200px; margin: 0 auto; }
        .category-header { font-weight: bold; text-transform: uppercase; color: var(--accent); border-bottom: 2px solid var(--accent); display: flex; align-items: center; justify-content: center; height: 60px; font-size: 1.2em; }
        .cell { background: #16213e; border: 2px solid #333; color: var(--gold); font-size: 2em; padding: 30px 0; cursor: pointer; border-radius: 5px; }
        .cell.used { opacity: 0.1; background: #000; cursor: default; }
        
        #admin-bar { position: fixed; bottom: 0; width: 100%; background: #222; padding: 15px; display: flex; justify-content: center; gap: 20px; align-items: center; border-top: 2px solid var(--accent); z-index: 100; }
        #buzzer-alert { background: #e94560; color: white; font-size: 2em; padding: 20px; margin: 10px auto; width: 70%; border-radius: 10px; display: none; }

        /* Form Interface Styles */
        #modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:200; overflow-y: scroll; padding: 20px; }
        .editor-container { background:#1a1a2e; padding:30px; border:2px solid var(--accent); max-width:900px; margin:auto; border-radius: 15px; }
        .entry-row { display: grid; grid-template-columns: 1fr 2fr 2fr 80px; gap: 10px; margin-bottom: 10px; align-items: center; }
        .entry-row input { padding: 8px; border-radius: 4px; border: 1px solid #444; background: #000; color: white; }
        .cat-input { background: var(--accent) !important; color: black !important; font-weight: bold; }
        button { cursor: pointer; padding: 10px; border-radius: 5px; border: none; font-weight: bold; }
    </style>
</head>
<body>

    <div class="scoreboard" id="scoreboard-container"></div>
    <div id="buzzer-alert">üîî <span id="winner">---</span> BUZZED!</div>
    <div class="grid" id="main-grid"></div>

    <div id="admin-bar">
        <button onclick="pickRandomTeam()" style="background:var(--gold);">üé≤ RANDOM TEAM</button>
        <button onclick="resetBuzzer()" style="background:#e94560; color:white;">RESET BUZZERS</button>
        <button onclick="document.getElementById('modal').style.display='block'">üìù EDIT QUESTIONS</button>
        <span style="color:#888">Teams: <input type="number" id="team-count" value="3" min="2" max="6" style="width:35px" onchange="initTeams()"></span>
    </div>

    <div id="modal">
        <div class="editor-container">
            <h2>Question Editor</h2>
            <div id="form-builder">
                <div class="entry-row" style="font-weight: bold; color: var(--accent);">
                    <div>Category</div><div>Question</div><div>Answer</div><div>Points</div>
                </div>
                </div>
            <button onclick="saveAll()" style="background:green; color:white; width:100%; margin-top:20px; padding: 15px; font-size: 1.2em;">UPDATE GAME BOARD</button>
            <button onclick="document.getElementById('modal').style.display='none'" style="margin-top:10px; background: #444; color: white;">Close Without Saving</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBYYe4I-spWUJ6ORpbue_XKT8pqowmQNqo",
            authDomain: "trivia-game-3fe59.firebaseapp.com",
            databaseURL: "https://trivia-game-3fe59-default-rtdb.firebaseio.com",
            projectId: "trivia-game-3fe59",
            storageBucket: "trivia-game-3fe59.firebasestorage.app",
            messagingSenderId: "851139559118",
            appId: "1:851139559118:web:df59f13dfd9234c1e89a9f",
            measurementId: "G-GC3LZ9K9YZ"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Setup the Form with empty boxes
        function setupForm() {
            const builder = document.getElementById('form-builder');
            // Create 3 columns of 4 questions each
            for(let c=1; c<=3; c++) {
                const catInput = document.createElement('input');
                catInput.placeholder = "Category " + c;
                catInput.className = "cat-input";
                catInput.id = `cat-${c}`;
                
                let rowHead = document.createElement('div');
                rowHead.className = "entry-row";
                rowHead.style.marginTop = "20px";
                rowHead.appendChild(catInput);
                builder.appendChild(rowHead);

                for(let q=1; q<=4; q++) {
                    let row = document.createElement('div');
                    row.className = "entry-row";
                    row.innerHTML = `
                        <div></div>
                        <input type="text" placeholder="Question" class="q-in" data-cat="${c}">
                        <input type="text" placeholder="Answer" class="a-in">
                        <input type="number" value="${q * 200}" class="p-in">
                    `;
                    builder.appendChild(row);
                }
            }
        }

        function saveAll() {
            const grid = document.getElementById('main-grid');
            grid.innerHTML = "";
            grid.style.gridTemplateColumns = "repeat(3, 1fr)";

            for(let c=1; c<=3; c++) {
                const catTitle = document.getElementById(`cat-${c}`).value || "Category " + c;
                const header = document.createElement('div');
                header.className = 'category-header';
                header.innerText = catTitle;
                header.style.gridRow = "1";
                header.style.gridColumn = c;
                grid.appendChild(header);

                const questions = document.querySelectorAll(`.q-in[data-cat="${c}"]`);
                questions.forEach((qInput, index) => {
                    const row = index + 2;
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    const points = qInput.parentElement.querySelector('.p-in').value;
                    const answer = qInput.parentElement.querySelector('.a-in').value;
                    
                    cell.innerText = '$' + points;
                    cell.style.gridRow = row;
                    cell.style.gridColumn = c;

                    cell.onclick = function() {
                        if(!this.classList.contains('used')) {
                            alert("Q: " + qInput.value + "\n\nA: " + answer);
                            this.classList.add('used');
                        }
                    };
                    grid.appendChild(cell);
                });
            }
            document.getElementById('modal').style.display = 'none';
        }

        // Standard logic remains the same
        function initTeams() {
            const count = document.getElementById('team-count').value;
            db.ref('settings/teamCount').set(parseInt(count));
            const container = document.getElementById('scoreboard-container');
            container.innerHTML = "";
            for(let i=1; i<=count; i++) {
                const teamId = 't'+i;
                const card