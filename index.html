<!DOCTYPE html>
<html>
<head>
    <title>Ultimate Trivia - Host</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --main-blue: #1a1a2e; --accent: #00d2ff; --gold: #ffd700; }
        body { background: var(--main-blue); color: white; font-family: sans-serif; text-align: center; margin: 0; padding-bottom: 100px; }
        
        /* Scoreboard */
        .scoreboard { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; padding: 20px; background: rgba(0,0,0,0.3); }
        .team-card { background: #16213e; border: 2px solid var(--accent); padding: 15px; border-radius: 10px; min-width: 160px; transition: 0.3s; }
        .team-card.highlight { border-color: var(--gold); box-shadow: 0 0 20px var(--gold); transform: scale(1.05); }
        .team-name { background: transparent; border: none; color: white; font-size: 1.2em; text-align: center; width: 100%; border-bottom: 1px dashed #444; }
        .score-display { font-size: 2.5em; color: var(--gold); font-weight: bold; margin: 10px 0; }
        
        /* Grid */
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; padding: 30px; max-width: 1200px; margin: 0 auto; }
        .category-header { font-weight: bold; text-transform: uppercase; color: var(--accent); border-bottom: 2px solid var(--accent); display: flex; align-items: center; justify-content: center; height: 60px; }
        .cell { background: #16213e; border: 2px solid #333; color: var(--gold); font-size: 2em; padding: 30px 0; cursor: pointer; border-radius: 5px; }
        .cell.used { opacity: 0.1; background: #000; cursor: default; }
        
        /* Admin Bar */
        #buzzer-alert { background: #e94560; color: white; font-size: 2em; padding: 20px; margin: 10px auto; width: 70%; border-radius: 10px; display: none; }
        #admin-bar { position: fixed; bottom: 0; width: 100%; background: #222; padding: 15px; display: flex; justify-content: center; gap: 20px; align-items: center; border-top: 2px solid var(--accent); z-index: 100; }
        textarea { width: 100%; height: 200px; background: #000; color: #0f0; font-family: monospace; }
        #modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:200; padding: 50px; box-sizing: border-box; }
        button { cursor: pointer; padding: 10px; border-radius: 5px; border: none; font-weight: bold; }
    </style>
</head>
<body>

    <div class="scoreboard" id="scoreboard-container"></div>
    <div id="buzzer-alert">ðŸ”” <span id="winner">---</span> BUZZED!</div>
    <div class="grid" id="main-grid"></div>

    <div id="admin-bar">
        <button onclick="pickRandomTeam()" style="background:var(--gold);">ðŸŽ² RANDOM TEAM</button>
        <button onclick="resetBuzzer()" style="background:#e94560; color:white;">RESET BUZZERS</button>
        <button onclick="document.getElementById('modal').style.display='block'">EDIT QUESTIONS</button>
        <span style="color:#888">Teams: <input type="number" id="team-count" value="3" min="2" max="6" style="width:35px" onchange="initTeams()"></span>
        <button onclick="clearAllTeams()" style="background:#444; color:white; font-size: 10px;">RESET SESSIONS</button>
    </div>

    <div id="modal">
        <div style="background:#1a1a2e; padding:30px; border:2px solid var(--accent); max-width:600px; margin:auto;">
            <h3>Content Manager</h3>
            <p style="font-size: 0.8em; color: #888;"># Category | Question | Answer | Pts</p>
            <textarea id="q-input"># SCIENCE
Powerhouse of cell | Mitochondria | 200
Red Planet | Mars | 400
# HISTORY
First President | Washington | 200</textarea>
            <br><br>
            <button onclick="saveAll()" style="background:green; color:white; width:100%;">SAVE & UPDATE</button>
            <button onclick="document.getElementById('modal').style.display='none'" style="margin-top:10px;">Cancel</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBYYe4I-spWUJ6ORpbue_XKT8pqowmQNqo",
            authDomain: "trivia-game-3fe59.firebaseapp.com",
            databaseURL: "https://trivia-game-3fe59-default-rtdb.firebaseio.com",
            projectId: "trivia-game-3fe59",
            storageBucket: "trivia-game-3fe59.firebasestorage.app",
            messagingSenderId: "851139559118",
            appId: "1:851139559118:web:df59f13dfd9234c1e89a9f",
            measurementId: "G-GC3LZ9K9YZ"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function initTeams() {
            const count = document.getElementById('team-count').value;
            db.ref('settings/teamCount').set(parseInt(count));
            const container = document.getElementById('scoreboard-container');
            container.innerHTML = "";
            for(let i=1; i<=count; i++) {
                const teamId = 't'+i;
                const card = document.createElement('div');
                card.className = 'team-card';
                card.id = 'card-'+teamId;
                card.innerHTML = `
                    <input type="text" value="Team ${i}" class="team-name">
                    <div class="score-display" id="${teamId}">0</div>
                    <button onclick="adj('${teamId}', -100)">-</button> <button onclick="adj('${teamId}', 100)">+</button>
                `;
                container.appendChild(card);
            }
        }

        function adj(id, amt) {
            const el = document.getElementById(id);
            el.innerText = parseInt(el.innerText) + amt;
        }

        function pickRandomTeam() {
            const teams = document.querySelectorAll('.team-card');
            if(teams.length === 0) return;
            teams.forEach(t => t.classList.remove('highlight'));
            const rand = Math.floor(Math.random() * teams.length);
            teams[rand].classList.add('highlight');
            setTimeout(() => teams[rand].classList.remove('highlight'), 3000);
        }

        function updateBoard() {
            const grid = document.getElementById('main-grid');
            grid.innerHTML = "";
            const lines = document.getElementById('q-input').value.split('\n');
            lines.forEach(line => {
                if(line.startsWith('#')) {
                    const h = document.createElement('div');
                    h.className = 'category-header';
                    h.innerText = line.replace('#','').trim();
                    grid.appendChild(h);
                } else if(line.includes('|')) {
                    const p = line.split('|');
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.innerText = '$' + (p[2] || '200').trim();
                    cell.onclick = function() { 
                        if(!this.classList.contains('used')) {
                            alert("Q: " + p[0].trim() + "\n\nA: " + p[1].trim());
                            this.classList.add('used');
                        }
                    };
                    grid.appendChild(cell);
                }
            });
        }

        function clearAllTeams() {
            if(confirm("Force all students to re-join?")) {
                db.ref('settings/sessionID').set(Date.now());
            }
        }

        function saveAll() { updateBoard(); document.getElementById('modal').style.display = 'none'; }

        db.ref('currentBuzz').on('value', (snap) => {
            const val = snap.val();
            document.getElementById('buzzer-alert').style.display = val ? 'block' : 'none';
            if(val) document.getElementById('winner').innerText = val.user.toUpperCase() + " (" + (val.team || "No Team") + ")";
        });

        function resetBuzzer() { db.ref('currentBuzz').set(null); }

        window.onload = () => { initTeams(); updateBoard(); };
    </script>
</body>
</html>
